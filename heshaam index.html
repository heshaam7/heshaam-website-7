// Basic setup for a shooting game using Three.js
// You need to include the Three.js library in your HTML
// <script src="https://cdn.jsdelivr.net/npm/three@0.150.0/build/three.min.js"></script>

let scene, camera, renderer, player, bullets = [], monsters = [];
let keys = {};

init();
animate();

function init() {
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);

  // Player
  player = new THREE.Mesh(
    new THREE.BoxGeometry(1, 1, 1),
    new THREE.MeshBasicMaterial({ color: 0x00ff00 })
  );
  scene.add(player);
  camera.position.z = 5;

  // Light
  const light = new THREE.DirectionalLight(0xffffff, 1);
  light.position.set(5, 5, 5).normalize();
  scene.add(light);

  // Event Listeners
  document.addEventListener('keydown', (e) => keys[e.key.toLowerCase()] = true);
  document.addEventListener('keyup', (e) => keys[e.key.toLowerCase()] = false);

  document.addEventListener('mousedown', (e) => {
    if (e.button === 0) shoot(); // Left click
    if (e.button === 2) aim();   // Right click
  });

  document.addEventListener('contextmenu', e => e.preventDefault());
}

function shoot() {
  const bullet = new THREE.Mesh(
    new THREE.SphereGeometry(0.1, 8, 8),
    new THREE.MeshBasicMaterial({ color: 0xff0000 })
  );
  bullet.position.copy(player.position);
  bullet.userData.velocity = new THREE.Vector3(0, 0, -1);
  scene.add(bullet);
  bullets.push(bullet);
}

function aim() {
  camera.fov = 30;
  camera.updateProjectionMatrix();
  setTimeout(() => {
    camera.fov = 75;
    camera.updateProjectionMatrix();
  }, 1000);
}

function animate() {
  requestAnimationFrame(animate);
  movePlayer();
  updateBullets();
  renderer.render(scene, camera);
}

function movePlayer() {
  if (keys['w']) player.position.z -= 0.1;
  if (keys['s']) player.position.z += 0.1;
  if (keys['a']) player.position.x -= 0.1;
  if (keys['d']) player.position.x += 0.1;
  camera.position.set(player.position.x, player.position.y + 1, player.position.z + 5);
  camera.lookAt(player.position);
}

function updateBullets() {
  bullets.forEach((b, i) => {
    b.position.add(b.userData.velocity);
    if (b.position.z < -50) {
      scene.remove(b);
      bullets.splice(i, 1);
    }
  });
}